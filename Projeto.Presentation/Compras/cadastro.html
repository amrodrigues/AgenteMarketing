<!DOCTYPE html>
<html ng-app="appCadastro">
<head>
    <meta charset="utf-8" />
    <title></title>

    <link href="../Content/bootstrap.min.css" rel="stylesheet" />

    <script src="../Scripts/jquery-3.0.0.min.js"></script>
    <script src="../Scripts/bootstrap.min.js"></script>

    <script src="../Scripts/angular.min.js"></script>

    <script>

        //criando uma aplicação baseada em AngularJS
        var app = angular.module('appCadastro', []);
        //declarando o controller..
        app.controller('cadastroController',
            function ($scope, $http) {

                //função para consultar os contatos..
                $scope.consultarContato = function () {
                    $http.get("https://localhost:44371/api/contato/consultar")
                        .then(function (obj) {
                            $scope.contato = obj.data;

                        })
                        .catch(function (e) {
                            $scope.mensagem = e.data.Mensagem;
                        });
                };


                //função para consultar os contatos..
                $scope.consultarProduto = function () {
                    $http.get("https://localhost:44371/api/produto/consultar")
                        .then(function (obj) {
                            $scope.produto = obj.data;

                        })
                        .catch(function (e) {
                            $scope.mensagem = e.data.Mensagem;
                        });
                };

                //$scope -> utilizada para declarar funções ou
                //variaveis dentro do controller angular
                //$http -> utilizado para acessar os serviços da API
                //fazendo requisições POST, PUT, GET, DELETE, etc

                //JSON com os dados que serão enviados..
                $scope.model = {
                    Quantidade: "", Valor: ""
                };

                //criando uma função..
                $scope.cadastrar = function () {
                  //  alert('11');

                    //imprimindo mensagem..
                    $scope.mensagem = "Processando, por favor aguarde.";

                    //acessar o serviço de cadastro da API..
                    $http.post("https://localhost:44371/api/vendaContato/cadastrar", $scope.model)
                        .then(function (obj) { //sucesso..
                            $scope.mensagem = obj.data.Mensagem;

                            //limpar os campos..
                            $scope.model.Quantidade = "";
                            $scope.model.Valor = "";
                            $scope.model.ContatoID = "";
                            $scope.model.ProdutoID = "";
                          })
                        .catch(function (e) { //erro..
                            $scope.mensagem = e.data.Mensagem;
                        });
                };
        });

    </script>

</head>
<body class="container" ng-controller="cadastroController">

    <h2>Cadastro de Compra</h2>
    <a href="/index.html">Página inicial</a>
    <hr />

    <div class="row">
        <div class="col-md-4">

            <label>Contato:</label>
            <select class="form-control" ng-model="model.ContatoID"
                    ng-init="consultarContato()">
                <option ng-repeat="c in contato | orderBy : Nome" value="{{c.ContatoID}}"
                        ng-selected="c.ContatoID == model.ContatoID">
                    {{c.Nome}}
                </option>
            </select>


            <label>Produto:</label>
            <select class="form-control" ng-model="model.ProdutoID"
                    ng-init="consultarProduto()">
                <option ng-repeat="p in produto | orderBy :NomeProduto" value="{{c.ProdutoID}}"
                        ng-selected="p.ProdutoID == model.ProdutoID">
                    {{p.NomeProduto}}
                </option>
            </select>
            <br />

            <label>Valor:</label>
            <input type="text" class="form-control"
                   placeholder="Digite aqui"
                   ng-model="model.Valor" />
            <br />

            <label>Quantidade:</label>
            <input type="text" class="form-control"
                   placeholder="Digite aqui"
                   ng-model="model.Quantidade" />
            <br />

            <button class="btn btn-success" ng-click="cadastrar()">
                Cadastrar Venda
            </button>


            <strong>{{mensagem}}</strong>

        </div>
    </div>

</body>
</html>